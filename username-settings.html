
<!-- username-settings.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ElemenTails — Username Settings</title>
  <!-- Ensure Firebase SDKs are already included on the page globally -->
</head>
<body style="background:#0b0c10;color:#e9eef5;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto">
  <div style="max-width:560px;margin:40px auto;padding:20px;background:#121520;border-radius:14px;box-shadow:0 18px 60px rgba(0,0,0,.5)">
    <h1 style="margin-top:0">Change Username</h1>
    <p style="color:#9aa4b2">Update your public username. 3–20 letters, numbers, or underscore. Must be unique.</p>
    <div style="display:flex;gap:10px;align-items:center">
      <input id="u" placeholder="new_username" style="flex:1;padding:12px;border-radius:10px;border:1px solid #2a3147;background:#0f1320;color:#fff">
      <button id="save" style="padding:12px 16px;border-radius:10px;border:0;background:#20c997;color:#06241e;font-weight:700;cursor:pointer">Save</button>
    </div>
    <div id="status" style="min-height:20px;margin-top:10px;font-size:14px"></div>
    <div style="margin-top:14px">
      <a href="mainmenu.html" style="color:#9aa4b2">Back to Menu</a>
    </div>
  </div>

  <script src="source/state/usernames.js"></script>
  <script>
    const input = document.getElementById('u');
    const btn = document.getElementById('save');
    const status = document.getElementById('status');

    function setStatus(msg, ok){ status.textContent = msg; status.style.color = ok ? '#63e6be' : '#ff6b6b'; }

    async function save(){
      const auth = firebase.auth();
      const user = auth.currentUser;
      if(!user){ setStatus('Not signed in.', false); return; }
      const v = (input.value||'').trim();
      if(!window.Username.regex.test(v)){ setStatus('3–20 letters/numbers/underscore only.', false); return; }
      setStatus('Checking availability…', true);
      const avail = await window.Username.checkAvailability(v);
      if(!avail.ok){ setStatus(avail.reason==='taken'?'That name is taken.':'Invalid username.', false); return; }
      try{
        await window.Username.changeUsername(user.uid, v);
        setStatus('Updated ✔', true);
      }catch(e){
        setStatus('Could not update username.', false);
      }
    }
    btn.addEventListener('click', save);
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') save(); });
  </script>
</body>
</html>
