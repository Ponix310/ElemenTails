<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ElemenTails - Main Menu</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .card {
      background: #333;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      text-align: center;
    }
    button {
      padding: 10px 20px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    #loginBtn { background: #4285F4; color: white; }
    #logoutBtn { background: #a33; color: white; display: none; }
    #menu { display: none; margin-top: 20px; }
    input[type="text"], input[type="color"] {
      margin: 6px 0;
      padding: 8px;
      border-radius: 6px;
      border: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>ElemenTails</h1>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn">Logout</button>

    <div id="menu">
      <h3>Set Your Identity</h3>
      <input type="text" id="username" placeholder="Enter username" />
      <input type="color" id="color" value="#ff0000" />
      <br>
      <button id="saveIdentity">Save Identity</button>
      <h3>Start a Game</h3>
      <button id="singleBtn">Single Player</button>
      <button id="multiBtn">Multiplayer</button>
    </div>
  </div>

  <script type="module">
    // Firebase config (keep same as project)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.getAuth(app);
    const db = firebase.getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const menu = document.getElementById("menu");
    const usernameInput = document.getElementById("username");
    const colorInput = document.getElementById("color");

    loginBtn.onclick = async () => {
      const provider = new firebase.GoogleAuthProvider();
      try {
        await firebase.signInWithPopup(auth, provider);
      } catch (e) {
        console.error("Login failed", e);
      }
    };

    logoutBtn.onclick = async () => {
      await firebase.signOut(auth);
    };

    firebase.onAuthStateChanged(auth, user => {
      if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        menu.style.display = "block";
      } else {
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        menu.style.display = "none";
      }
    });

    document.getElementById("saveIdentity").onclick = async () => {
      const user = auth.currentUser;
      if (!user) return;
      const username = usernameInput.value.trim();
      const color = colorInput.value;
      if (!username) {
        alert("Please enter a username");
        return;
      }
      await firebase.setDoc(firebase.doc(db, "users", user.uid), {
        username, color
      });
      alert("Identity saved!");
    };

    document.getElementById("singleBtn").onclick = () => {
      window.location.href = "partyselect.html?mode=single";
    };
    document.getElementById("multiBtn").onclick = () => {
      window.location.href = "partyselect.html?mode=multi";
    };
  </script>
</body>
</html>
