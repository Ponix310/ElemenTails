<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElemenTails â€” Main Menu</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="source/components/FriendsUsernameUI.js"></script>
</head>
<body>
    <header>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Elemen Tails</h1>
            <div id="user-controls">
                <span id="username-display"></span>
                <button id="login-btn">Login</button>
                <button id="logout-btn" style="display:none;">Logout</button>
            </div>
        </div>
    </header>

    <main style="display:flex; gap:20px;">
        <!-- Left: Singleplayer / Multiplayer -->
        <section style="flex:1; background:#111; padding:20px; border-radius:8px;">
            <h2>Game Modes</h2>
            <button id="singleplayer-btn">Singleplayer: New Run</button>
            <button id="multiplayer-btn">Multiplayer</button>
        </section>

        <!-- Right: Friends -->
        <section style="flex:1; background:#111; padding:20px; border-radius:8px;">
            <h2>Friends</h2>
            <div>
                <input type="text" id="friend-username" placeholder="Enter username">
                <button id="add-friend-btn">Add</button>
            </div>
            <ul id="friends-list">
                <li>(none yet)</li>
            </ul>
        </section>
    </main>

    <script type="module">
        import { auth, db, signInWithPopup, GoogleAuthProvider, signOut, doc, getDoc } from './firebase-config.js';
        import { renderFriendsUI } from './source/components/FriendsUsernameUI.js';

        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const usernameDisplay = document.getElementById('username-display');

        loginBtn.addEventListener('click', async () => {
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (err) {
                console.error(err);
            }
        });

        logoutBtn.addEventListener('click', async () => {
            await signOut(auth);
        });

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                usernameDisplay.textContent = user.displayName || '(no username)';
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                renderFriendsUI(user.uid);
            } else {
                usernameDisplay.textContent = '';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
                document.getElementById('friends-list').innerHTML = '<li>(none yet)</li>';
            }
        });
    </script>
</body>
</html>
